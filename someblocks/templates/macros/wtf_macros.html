{%- macro inline_field(field, label_text='') %}
<div class="control-group {% if field.errors %}error{% endif %}">
    {{field.label(class="control-label")}}
        <div class="controls">
        {%- with required = "required" if kwargs['required'] or field.flags.required else "" -%}
        {% if label_text %}
            {{field(placeholder=label_text, required=required, **kwargs)}}
        {% else %}
            {{field(placeholder=field.label.text, required=required, **kwargs)}}
        {% endif %}
        {%- endwith %}
        {%- if field.errors %}
            {%- for error in field.errors %}
                <p class="help-block">{{error}}</p>
            {%- endfor %}
        {%- elif field.description -%}
            <p class="help-block">{{field.description|safe}}</p>
        {%- endif %}
    </div>
</div>
{%- endmacro %}


{%- macro horizontal_field(field) %}
<div class="control-group {% if field.errors %}error{% endif %}">
    {{field.label(class="control-label")}}
    <div class="controls">
        {{field(**kwargs)}}
        {%- if field.errors %}
            {%- for error in field.errors %}
                <p class="help-block">{{error}}</p>
            {%- endfor %}
        {%- elif field.description -%}
            <p class="help-block">{{field.description|safe}}</p>
        {%- endif %}
    </div>
</div>
{% endmacro %}


{% macro navlink(endpoint, name, active='') %}
<li {% if endpoint == request.endpoint or active == endpoint %}class="active"{% endif %}><a href={{ url_for(endpoint) }}>{{ name }}</a>
{% endmacro %}


{% macro form_errors(form, hiddens=True) %}
{%- if form.errors %}
    {%- for fieldname, errors in form.errors.iteritems() %}

        {%- if (form[fieldname] and hiddens) or (form[fieldname] and hiddens != 'only') %}
            {%- for error in errors %}
                <p class="error">{{error}}</p>
            {%- endfor %}
        {%- endif %}

    {%- endfor %}
{%- endif %}
{%- endmacro %}


{# See https://gist.github.com/ligthyear/1284631 #}
{%- macro form_field_label(field) -%}
    <label for="{{ field.id }}">{{ field.label.text }}</label>
{% endmacro %}

{%- macro form_field_description(field) -%}
    {% if field.description %}
        <span class="help-block">{{ field.description }}</span>
    {% endif %}
{%- endmacro -%}

{%- macro form_field_errors(field) -%}
    {% if field.errors %}
        {%- for error in field.errors -%}
        <span class="label label-important">{{ error }}</span>
        {%- endfor -%}
    {% endif %}
{%- endmacro -%}

{%- macro form_field_boolean(field, inline=False) -%}
    <label class="checkbox {%- if inline -%}inline{%- endif -%}">
            {{ field(**kwargs) }}
            {{ field.label.text }}
            {{ form_field_description(field) }}
            {{ form_field_errors(field) }}
    </label>
{%- endmacro -%}

{%- macro form_field(field) -%}
    {% if field.type == 'HiddenField' %}
        {{ field() }}
    {% else %}
        {% if field.type == 'BooleanField' %}
            {{ form_field_boolean(field, **kwargs) }}
        {% else%}
            {{ form_field_label(field) }}
                    <div class="input" id="{{field.id}}-div">
            {% if field.type == 'RadioField' %}
                {{ field(class='radio', **kwargs) }}
            {% else %}
                {{ field(**kwargs) }}
            {% endif %}
            {{ form_field_description(field) }}
            {{ form_field_errors(field) }}
                    </div>
        {% endif %}
    {% endif %}
{%- endmacro -%}
